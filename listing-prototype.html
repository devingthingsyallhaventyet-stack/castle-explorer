<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Hampton Court Palace ‚Äî Scenic Route</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --text: #1a1a1a;
  --text-secondary: #585858;
  --text-muted: #8a8a8a;
  --bg: #ffffff;
  --bg-light: #f7f7f7;
  --border: #e8e8e8;
  --sage: #4a7c59;
  --sage-light: #e8f0ea;
  --gold: #e8a817;
  --blue: #1277e1;
  --radius: 12px;
  --radius-sm: 8px;
  --font-serif: 'DM Serif Display', Georgia, serif;
  --font-sans: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
}
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: var(--font-sans); background: #000; color: var(--text); -webkit-font-smoothing: antialiased; overflow: hidden; height: 100vh; height: 100dvh; }

/* ===== PHOTO LAYER ‚Äî scrolls behind the sheet ===== */
.photo-layer {
  position: fixed; top: 0; left: 0; right: 0; bottom: 0;
  overflow-y: auto; -webkit-overflow-scrolling: touch;
  z-index: 1;
}
.photo-layer-inner { padding-bottom: 280px; /* space for peeking sheet */ }

.gallery-item { width: 100%; position: relative; }
.gallery-item.photo { background: #111; }
.gallery-item.photo img { width: 100%; display: block; min-height: 50vh; max-height: 100vh; object-fit: cover; }

.gallery-item.street-view { height: 45vh; display: flex; gap: 2px; }
.sv-panel { flex: 1; position: relative; overflow: hidden; }
.sv-panel img, .sv-panel iframe { width: 100%; height: 100%; object-fit: cover; border: none; }
.sv-label { position: absolute; bottom: 12px; left: 12px; background: rgba(0,0,0,0.7); color: #fff; padding: 6px 14px; border-radius: 8px; font-size: 13px; font-weight: 600; display: flex; align-items: center; gap: 6px; backdrop-filter: blur(4px); }
.sv-label svg { width: 20px; height: 20px; fill: #fff; }

.gallery-item.map-tile { height: 40vh; }
.gallery-item.map-tile iframe { width: 100%; height: 100%; border: none; display: block; }
.map-badge { position: absolute; bottom: 12px; right: 12px; background: rgba(0,0,0,0.6); color: #fff; padding: 5px 12px; border-radius: 20px; font-size: 12px; font-weight: 500; backdrop-filter: blur(4px); }

.type-badge { position: absolute; bottom: 12px; left: 12px; background: rgba(0,0,0,0.7); color: #fff; padding: 6px 14px; border-radius: 8px; font-size: 13px; font-weight: 600; backdrop-filter: blur(4px); }

/* Overlay controls */
.gallery-overlay { position: fixed; top: 0; left: 0; right: 0; z-index: 5; padding: 12px 16px; display: flex; justify-content: space-between; align-items: center; pointer-events: none; transition: opacity 0.3s; }
.gallery-overlay > * { pointer-events: auto; }
.gallery-overlay.hidden { opacity: 0; pointer-events: none; }
.close-btn { width: 36px; height: 36px; border-radius: 50%; background: rgba(0,0,0,0.5); border: none; color: #fff; font-size: 22px; display: flex; align-items: center; justify-content: center; cursor: pointer; backdrop-filter: blur(4px); }
.overlay-actions { display: flex; gap: 8px; }
.overlay-actions button { width: 40px; height: 40px; border-radius: 50%; background: rgba(0,0,0,0.5); border: none; color: #fff; font-size: 18px; display: flex; align-items: center; justify-content: center; cursor: pointer; backdrop-filter: blur(4px); }

/* ===== BOTTOM SHEET ===== */
.bottom-sheet {
  position: fixed; left: 0; right: 0; bottom: 0;
  z-index: 10;
  background: var(--bg);
  border-radius: 16px 16px 0 0;
  box-shadow: 0 -4px 20px rgba(0,0,0,0.25);
  transition: transform 0.35s cubic-bezier(0.32, 0.72, 0, 1);
  will-change: transform;
  max-height: 95vh; max-height: 95dvh;
  display: flex; flex-direction: column;
}
.bottom-sheet.dragging { transition: none; }

/* Peek state: show header + stats + buttons */
.sheet-peek {
  flex-shrink: 0;
  padding: 0 16px 12px;
  cursor: grab;
  touch-action: none;
}
.sheet-handle { width: 36px; height: 4px; background: #ccc; border-radius: 2px; margin: 10px auto 12px; }

.listing-name { font-family: var(--font-serif); font-size: 24px; line-height: 1.2; margin-bottom: 4px; }
.listing-location { font-size: 14px; color: var(--text-secondary); margin-bottom: 12px; }
.listing-location a { color: var(--blue); text-decoration: none; }

.key-stats { display: flex; gap: 0; margin-bottom: 12px; border: 1px solid var(--border); border-radius: var(--radius); overflow: hidden; }
.stat-item { flex: 1; text-align: center; padding: 12px 4px; }
.stat-item:not(:last-child) { border-right: 1px solid var(--border); }
.stat-value { font-size: 16px; font-weight: 700; }
.stat-label { font-size: 10px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; margin-top: 2px; }

.peek-buttons { display: flex; gap: 10px; }
.peek-buttons .btn { flex: 1; padding: 13px 16px; border-radius: var(--radius); font-size: 14px; font-weight: 600; font-family: var(--font-sans); cursor: pointer; text-align: center; display: flex; align-items: center; justify-content: center; gap: 6px; }
.btn-primary { background: var(--sage); color: #fff; border: none; }
.btn-secondary { background: var(--bg); color: var(--text); border: 1.5px solid var(--border); }

/* Scrollable detail area */
.sheet-scroll {
  flex: 1; overflow-y: auto; -webkit-overflow-scrolling: touch;
  padding: 0 16px 40px;
  overscroll-behavior: contain;
}

.divider { height: 1px; background: var(--border); margin: 20px 0; }
.section-title { font-family: var(--font-serif); font-size: 20px; margin-bottom: 12px; }

.rating-bar { display: flex; align-items: center; gap: 14px; padding: 4px 0 16px; }
.rating-big { font-size: 42px; font-weight: 700; line-height: 1; }
.rating-stars { color: var(--gold); font-size: 18px; letter-spacing: 1px; }
.rating-count { font-size: 13px; color: var(--text-muted); margin-top: 2px; }
.rating-rank { font-size: 12px; color: var(--sage); font-weight: 600; margin-top: 2px; }

.tags-row { display: flex; flex-wrap: wrap; gap: 6px; margin-bottom: 16px; }
.tag { padding: 6px 12px; border-radius: 20px; font-size: 12px; font-weight: 500; background: var(--bg-light); color: var(--text-secondary); border: 1px solid var(--border); }

.access-bar { padding: 12px 16px; background: var(--sage-light); border-radius: var(--radius); display: flex; align-items: center; gap: 10px; margin-bottom: 16px; }
.access-bar .icon { font-size: 20px; }
.access-bar .label { font-size: 13px; font-weight: 600; color: var(--sage); }
.access-bar .sublabel { font-size: 12px; color: var(--text-muted); }

.description { font-size: 14px; line-height: 1.7; color: var(--text-secondary); margin-bottom: 16px; }

.hours-grid { display: grid; grid-template-columns: 110px 1fr; gap: 4px 12px; font-size: 13px; }
.hours-day { font-weight: 600; }
.hours-time { color: var(--text-secondary); }

.review-card { padding: 14px 0; border-bottom: 1px solid var(--border); }
.review-card:last-of-type { border-bottom: none; }
.review-header { display: flex; align-items: center; gap: 10px; margin-bottom: 6px; }
.review-avatar { width: 36px; height: 36px; border-radius: 50%; background: var(--bg-light); display: flex; align-items: center; justify-content: center; font-size: 14px; font-weight: 600; color: var(--text-muted); flex-shrink: 0; }
.review-meta { flex: 1; }
.review-author { font-size: 13px; font-weight: 600; }
.review-date { font-size: 11px; color: var(--text-muted); }
.review-stars-sm { font-size: 12px; color: var(--gold); margin-bottom: 4px; }
.review-body { font-size: 13px; line-height: 1.6; color: var(--text-secondary); }
.reviews-all-link { display: block; text-align: center; padding: 14px; font-size: 14px; font-weight: 600; color: var(--blue); text-decoration: none; border: 1px solid var(--border); border-radius: var(--radius); margin-top: 12px; }

.video-card { border-radius: var(--radius); overflow: hidden; margin-bottom: 12px; border: 1px solid var(--border); cursor: pointer; }
.video-thumb { position: relative; aspect-ratio: 16/9; background: #000; }
.video-thumb img { width: 100%; height: 100%; object-fit: cover; }
.video-thumb .play-btn { position: absolute; top: 50%; left: 50%; transform: translate(-50%,-50%); width: 52px; height: 52px; background: rgba(0,0,0,0.7); border-radius: 50%; display: flex; align-items: center; justify-content: center; }
.video-thumb .play-btn svg { fill: #fff; width: 22px; height: 22px; margin-left: 3px; }
.video-meta { padding: 10px 12px; background: var(--bg); }
.video-title { font-size: 13px; font-weight: 600; line-height: 1.4; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
.video-channel { font-size: 11px; color: var(--text-muted); margin-top: 2px; }
.video-embed { position: relative; aspect-ratio: 16/9; border-radius: var(--radius); overflow: hidden; margin-bottom: 12px; }
.video-embed iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none; }

.nearby-scroll { display: flex; gap: 12px; overflow-x: auto; padding-bottom: 8px; -webkit-overflow-scrolling: touch; margin: 0 -16px; padding: 0 16px 8px; }
.nearby-scroll::-webkit-scrollbar { display: none; }
.nearby-card { min-width: 150px; max-width: 150px; border-radius: var(--radius); border: 1px solid var(--border); overflow: hidden; cursor: pointer; flex-shrink: 0; background: var(--bg); }
.nearby-card-img { width: 100%; aspect-ratio: 4/3; background: var(--bg-light); display: flex; align-items: center; justify-content: center; font-size: 32px; }
.nearby-card-info { padding: 8px 10px; }
.nearby-card-name { font-size: 12px; font-weight: 600; line-height: 1.3; margin-bottom: 2px; }
.nearby-card-meta { font-size: 11px; color: var(--text-muted); }

/* Links section */
.links-section { margin-bottom: 16px; }
.link-row { display: flex; align-items: center; gap: 12px; padding: 12px 0; border-bottom: 1px solid var(--border); text-decoration: none; color: var(--text); }
.link-row:last-child { border-bottom: none; }
.link-icon { width: 40px; height: 40px; border-radius: 10px; background: var(--bg-light); display: flex; align-items: center; justify-content: center; font-size: 18px; flex-shrink: 0; }
.link-info { flex: 1; min-width: 0; }
.link-label { font-size: 13px; font-weight: 600; }
.link-url { font-size: 12px; color: var(--text-muted); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.link-arrow { color: var(--text-muted); font-size: 16px; flex-shrink: 0; }

/* Share button */
.share-bar { display: flex; gap: 10px; margin: 16px 0; }
.share-bar .btn { flex: 1; padding: 12px; border-radius: var(--radius); font-size: 13px; font-weight: 600; font-family: var(--font-sans); cursor: pointer; text-align: center; display: flex; align-items: center; justify-content: center; gap: 6px; }
.btn-share { background: var(--bg); color: var(--text); border: 1.5px solid var(--border); }
.btn-gmaps { background: var(--bg); color: var(--blue); border: 1.5px solid var(--border); }
.share-toast { position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%); background: #333; color: #fff; padding: 10px 20px; border-radius: 8px; font-size: 13px; font-weight: 500; z-index: 200; opacity: 0; transition: opacity 0.3s; pointer-events: none; }
.share-toast.show { opacity: 1; }

@media (min-width: 768px) {
  .listing-name { font-size: 28px; }
  .bottom-sheet { max-width: 680px; left: 50%; right: auto; transform: translateX(-50%); width: 100%; }
}
</style>
</head>
<body>

<!-- PHOTO LAYER -->
<div class="photo-layer" id="photoLayer">
  <div class="photo-layer-inner">
    <!-- Overlay -->
    <div class="gallery-overlay" id="galleryOverlay">
      <button class="close-btn" onclick="history.back()">‚úï</button>
      <div class="overlay-actions">
        <button onclick="this.classList.toggle('fav-active');this.textContent=this.classList.contains('fav-active')?'‚ù§':'‚ô°'">‚ô°</button>
        <button>‚Üó</button>
        <button>‚ãØ</button>
      </div>
    </div>

    <!-- Photo 1 -->
    <div class="gallery-item photo"><img id="img1" src="" /><div class="type-badge">üëë Palace</div></div>
    <!-- Photo 2 -->
    <div class="gallery-item photo"><img id="img2" src="" /></div>
    <!-- Street View + Satellite -->
    <div class="gallery-item street-view">
      <div class="sv-panel" onclick="window.open('https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=51.4036,-0.3378','_blank')">
        <img id="svImg" src="" />
        <div class="sv-label">
          <svg viewBox="0 0 24 24"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg>
          Look Around
        </div>
      </div>
      <div class="sv-panel">
        <iframe src="https://www.google.com/maps/embed/v1/view?key=AIzaSyA1OrSJLhSG2YOLKPAo9-Jk0Lwoe4X0SX8&center=51.4036,-0.3378&zoom=15&maptype=satellite" loading="lazy"></iframe>
      </div>
    </div>
    <!-- Map -->
    <div class="gallery-item map-tile" style="position:relative">
      <iframe src="https://www.google.com/maps/embed/v1/place?key=AIzaSyA1OrSJLhSG2YOLKPAo9-Jk0Lwoe4X0SX8&q=Hampton+Court+Palace&zoom=14" loading="lazy"></iframe>
      <div class="map-badge">üìç London, England</div>
    </div>
    <!-- Photos 3-6 -->
    <div class="gallery-item photo" id="p3"><img id="img3" src="" /></div>
    <div class="gallery-item photo" id="p4"><img id="img4" src="" /></div>
    <div class="gallery-item photo" id="p5"><img id="img5" src="" /></div>
    <div class="gallery-item photo" id="p6"><img id="img6" src="" /></div>
  </div>
</div>

<!-- BOTTOM SHEET -->
<div class="bottom-sheet" id="sheet">
  <!-- Peek header ‚Äî always visible -->
  <div class="sheet-peek" id="sheetPeek">
    <div class="sheet-handle"></div>
    <h1 class="listing-name">Hampton Court Palace</h1>
    <div class="listing-location">London, England ¬∑ <a href="https://www.google.com/maps/dir/?api=1&destination=51.4036,-0.3378" target="_blank">Get directions</a></div>
    <div class="key-stats">
      <div class="stat-item"><div class="stat-value">üëë</div><div class="stat-label">Palace</div></div>
      <div class="stat-item"><div class="stat-value">1514</div><div class="stat-label">Built</div></div>
      <div class="stat-item"><div class="stat-value">Intact</div><div class="stat-label">Condition</div></div>
      <div class="stat-item"><div class="stat-value">¬£29</div><div class="stat-label">Admission</div></div>
    </div>
    <div class="peek-buttons">
      <button class="btn btn-secondary">‚òÜ Save</button>
      <button class="btn btn-primary">üöó Add to Route</button>
    </div>
  </div>

  <!-- Scrollable details -->
  <div class="sheet-scroll" id="sheetScroll">
    <div class="divider"></div>

    <div class="rating-bar">
      <div class="rating-big">4.7</div>
      <div>
        <div class="rating-stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
        <div class="rating-count">9,870 Google reviews</div>
        <div class="rating-rank">#3 rated palace in England</div>
      </div>
    </div>

    <div class="tags-row">
      <span class="tag">üè∞ Well Preserved</span>
      <span class="tag">üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Kid-Friendly</span>
      <span class="tag">üëª Haunted</span>
      <span class="tag">üì∏ Photogenic</span>
    </div>

    <div class="access-bar">
      <span class="icon">üéüÔ∏è</span>
      <div>
        <div class="label">Paid Admission</div>
        <div class="sublabel">Book online for discounted entry</div>
      </div>
    </div>

    <!-- Share + Links -->
    <div class="share-bar">
      <button class="btn btn-share" onclick="shareListing()">üì§ Share</button>
      <a class="btn btn-gmaps" href="https://www.google.com/maps/dir/?api=1&destination=51.4036,-0.3378" target="_blank">üìç Google Maps</a>
    </div>

    <div class="links-section" id="linksSection" style="display:none"></div>

    <div class="divider"></div>

    <h2 class="section-title">About</h2>
    <div class="description">
      Originally built for Cardinal Wolsey and later seized by Henry VIII, Hampton Court Palace blends Tudor and Baroque architecture. Its famous maze and gardens attract visitors year-round.
      <br><br>
      Hampton Court Palace is a Grade I listed royal palace in the London Borough of Richmond upon Thames, 12 miles southwest and upstream of central London on the River Thames. It has been a significant royal palace since the early 16th century and today serves as a major tourist attraction, managed by Historic Royal Palaces.
    </div>

    <div class="divider"></div>

    <h2 class="section-title">Opening Hours</h2>
    <div class="hours-grid" id="hoursGrid"></div>

    <div class="divider"></div>

    <h2 class="section-title">Videos</h2>
    <div id="videoCards">Loading...</div>

    <div class="divider"></div>

    <h2 class="section-title">Reviews</h2>
    <div id="reviewCards">Loading...</div>

    <div class="divider"></div>

    <h2 class="section-title">Nearby Sites</h2>
    <div class="nearby-scroll">
      <div class="nearby-card"><div class="nearby-card-img">üè∞</div><div class="nearby-card-info"><div class="nearby-card-name">Windsor Castle</div><div class="nearby-card-meta">‚òÖ 4.7 ¬∑ 15 km</div></div></div>
      <div class="nearby-card"><div class="nearby-card-img">üè∞</div><div class="nearby-card-info"><div class="nearby-card-name">Tower of London</div><div class="nearby-card-meta">‚òÖ 4.6 ¬∑ 19 km</div></div></div>
      <div class="nearby-card"><div class="nearby-card-img">‚õ™</div><div class="nearby-card-info"><div class="nearby-card-name">Waverley Abbey</div><div class="nearby-card-meta">‚òÖ 4.3 ¬∑ 28 km</div></div></div>
      <div class="nearby-card"><div class="nearby-card-img">üè∞</div><div class="nearby-card-info"><div class="nearby-card-name">Farnham Castle</div><div class="nearby-card-meta">‚òÖ 4.4 ¬∑ 26 km</div></div></div>
      <div class="nearby-card"><div class="nearby-card-img">üëë</div><div class="nearby-card-info"><div class="nearby-card-name">Kew Palace</div><div class="nearby-card-meta">‚òÖ 4.3 ¬∑ 7 km</div></div></div>
    </div>

    <div style="height: 60px;"></div>
  </div>
</div>

<div class="share-toast" id="shareToast">Link copied!</div>

<script>
const API_KEY = 'AIzaSyA1OrSJLhSG2YOLKPAo9-Jk0Lwoe4X0SX8';
const LAT = 51.4036, LNG = -0.3378;

// Street View static
document.getElementById('svImg').src = `https://maps.googleapis.com/maps/api/streetview?size=600x400&location=${LAT},${LNG}&key=${API_KEY}`;

// ===== BOTTOM SHEET DRAG =====
const sheet = document.getElementById('sheet');
const sheetPeek = document.getElementById('sheetPeek');
const sheetScroll = document.getElementById('sheetScroll');
const photoLayer = document.getElementById('photoLayer');

// Calculate positions
let peekHeight = 0;
let sheetFullY = 0; // Y when fully expanded (top of screen + some padding)
let sheetPeekY = 0; // Y when peeking (bottom, showing just header)
let currentY = 0;
let expanded = false;

function measureSheet() {
  peekHeight = sheetPeek.offsetHeight + 16; // +16 for handle area
  const vh = window.innerHeight;
  sheetPeekY = vh - peekHeight;
  sheetFullY = vh * 0.05; // 5% from top when fully expanded
  if (!expanded) {
    currentY = sheetPeekY;
    sheet.style.transform = `translateY(${currentY}px)`;
    sheet.style.height = `${vh - sheetFullY}px`;
  }
}

measureSheet();
window.addEventListener('resize', measureSheet);

// Drag handling
let startTouchY = 0;
let startSheetY = 0;
let isDragging = false;
let dragTarget = null;

sheetPeek.addEventListener('touchstart', onDragStart, { passive: true });
sheetPeek.addEventListener('mousedown', onDragStart);

function onDragStart(e) {
  const touch = e.touches ? e.touches[0] : e;
  startTouchY = touch.clientY;
  startSheetY = currentY;
  isDragging = true;
  sheet.classList.add('dragging');
  document.addEventListener('touchmove', onDragMove, { passive: false });
  document.addEventListener('mousemove', onDragMove);
  document.addEventListener('touchend', onDragEnd);
  document.addEventListener('mouseup', onDragEnd);
}

function onDragMove(e) {
  if (!isDragging) return;
  e.preventDefault();
  const touch = e.touches ? e.touches[0] : e;
  const dy = touch.clientY - startTouchY;
  let newY = startSheetY + dy;
  newY = Math.max(sheetFullY, Math.min(sheetPeekY, newY));
  currentY = newY;
  sheet.style.transform = `translateY(${currentY}px)`;
  // Dim photos when sheet is up
  const progress = 1 - (currentY - sheetFullY) / (sheetPeekY - sheetFullY);
  photoLayer.style.opacity = 1 - progress * 0.4;
}

function onDragEnd() {
  if (!isDragging) return;
  isDragging = false;
  sheet.classList.remove('dragging');
  document.removeEventListener('touchmove', onDragMove);
  document.removeEventListener('mousemove', onDragMove);
  document.removeEventListener('touchend', onDragEnd);
  document.removeEventListener('mouseup', onDragEnd);

  // Snap threshold: just 15% drag from peek position triggers expand
  const threshold = sheetPeekY - (sheetPeekY - sheetFullY) * 0.15;
  if (currentY < threshold) {
    expanded = true;
    currentY = sheetFullY;
    photoLayer.style.opacity = 0.6;
  } else {
    expanded = false;
    currentY = sheetPeekY;
    photoLayer.style.opacity = 1;
    sheetScroll.scrollTop = 0;
  }
  sheet.style.transform = `translateY(${currentY}px)`;
}

// Allow scroll-down in sheet to collapse when at top
sheetScroll.addEventListener('touchstart', (e) => {
  if (expanded && sheetScroll.scrollTop <= 0) {
    dragTarget = 'scroll';
    startTouchY = e.touches[0].clientY;
    startSheetY = currentY;
  }
}, { passive: true });

sheetScroll.addEventListener('touchmove', (e) => {
  if (dragTarget === 'scroll' && sheetScroll.scrollTop <= 0) {
    const dy = e.touches[0].clientY - startTouchY;
    if (dy > 0) {
      // Pulling down ‚Äî start collapsing
      e.preventDefault();
      let newY = startSheetY + dy;
      newY = Math.max(sheetFullY, Math.min(sheetPeekY, newY));
      currentY = newY;
      sheet.classList.add('dragging');
      sheet.style.transform = `translateY(${currentY}px)`;
      const progress = 1 - (currentY - sheetFullY) / (sheetPeekY - sheetFullY);
      photoLayer.style.opacity = 1 - progress * 0.4;
    }
  }
}, { passive: false });

sheetScroll.addEventListener('touchend', () => {
  if (dragTarget === 'scroll') {
    dragTarget = null;
    sheet.classList.remove('dragging');
    const collapseThreshold = sheetFullY + (sheetPeekY - sheetFullY) * 0.15;
    if (currentY < collapseThreshold) {
      expanded = true;
      currentY = sheetFullY;
      photoLayer.style.opacity = 0.6;
    } else {
      expanded = false;
      currentY = sheetPeekY;
      photoLayer.style.opacity = 1;
      sheetScroll.scrollTop = 0;
    }
    sheet.style.transform = `translateY(${currentY}px)`;
  }
});

// Tap on peek area to expand
sheetPeek.addEventListener('click', (e) => {
  if (e.target.tagName === 'BUTTON' || e.target.tagName === 'A' || e.target.closest('button') || e.target.closest('a')) return;
  if (!expanded) {
    expanded = true;
    currentY = sheetFullY;
    sheet.style.transform = `translateY(${currentY}px)`;
    photoLayer.style.opacity = 0.6;
  }
});

// Auto-expand when photo scroll reaches bottom
photoLayer.addEventListener('scroll', () => {
  const el = photoLayer;
  if (el.scrollHeight - el.scrollTop - el.clientHeight < 50 && !expanded) {
    expanded = true;
    currentY = sheetFullY;
    sheet.style.transform = `translateY(${currentY}px)`;
    photoLayer.style.opacity = 0.6;
  }
});

// ===== DATA LOADING =====
async function loadGoogleData() {
  const script = document.createElement('script');
  script.src = `https://maps.googleapis.com/maps/api/js?key=${API_KEY}&libraries=places&v=weekly`;
  document.head.appendChild(script);
  script.onload = async () => {
    try {
      const { Place } = await google.maps.importLibrary('places');
      const { places } = await Place.searchByText({
        textQuery: 'Hampton Court Palace London England',
        fields: ['displayName','rating','userRatingCount','photos','regularOpeningHours','googleMapsURI','reviews','websiteURI'],
        locationBias: { lat: LAT, lng: LNG },
        maxResultCount: 1
      });
      if (places && places.length > 0) {
        const p = places[0];
        try { await p.fetchFields({ fields: ['reviews'] }); } catch(e) {}
        renderPhotos(p);
        renderHours(p);
        renderReviews(p);
        renderLinks(p);
      }
    } catch(e) { console.warn(e); }
  };
}

function renderPhotos(place) {
  if (!place.photos) return;
  const photos = place.photos.slice(0, 8);
  photos.forEach((p, i) => {
    const el = document.getElementById(`img${i + 1}`);
    if (el) el.src = p.getURI ? p.getURI({ maxWidth: 1200, maxHeight: 900 }) : '';
  });
  for (let i = photos.length + 1; i <= 6; i++) {
    const c = document.getElementById(`p${i}`);
    if (c) c.style.display = 'none';
  }
}

function renderHours(place) {
  if (!place.regularOpeningHours) return;
  document.getElementById('hoursGrid').innerHTML = (place.regularOpeningHours.weekdayDescriptions || []).map(d => {
    const p = d.split(': ');
    return `<div class="hours-day">${p[0]}</div><div class="hours-time">${p[1]||''}</div>`;
  }).join('');
}

function renderReviews(place) {
  if (!place.reviews || !place.reviews.length) { document.getElementById('reviewCards').innerHTML = ''; return; }
  document.getElementById('reviewCards').innerHTML = place.reviews.slice(0, 5).map(r => {
    const stars = '‚òÖ'.repeat(Math.floor(r.rating||0)) + '‚òÜ'.repeat(5-Math.floor(r.rating||0));
    const author = r.authorAttribution ? r.authorAttribution.displayName : 'Anonymous';
    const time = r.relativePublishTimeDescription || '';
    const text = r.text ? (typeof r.text==='string'?r.text:(r.text.text||'')) : '';
    return `<div class="review-card"><div class="review-header"><div class="review-avatar">${author.charAt(0)}</div><div class="review-meta"><div class="review-author">${author}</div><div class="review-date">${time}</div></div></div><div class="review-stars-sm">${stars}</div><div class="review-body">${text.length>250?text.substring(0,250)+'‚Ä¶':text}</div></div>`;
  }).join('') + `<a class="reviews-all-link" href="${place.googleMapsURI||'#'}" target="_blank">Read all ${(place.userRatingCount||9870).toLocaleString()} reviews</a>`;
}

function renderLinks(place) {
  const el = document.getElementById('linksSection');
  const links = [];

  if (place.websiteURI) {
    const domain = place.websiteURI.replace(/^https?:\/\//, '').replace(/\/.*$/, '');
    links.push({ icon: 'üåê', label: 'Official Website', url: place.websiteURI, display: domain });
  }

  if (place.googleMapsURI) {
    links.push({ icon: 'üìç', label: 'Google Maps', url: place.googleMapsURI, display: 'View on Google Maps' });
  }

  // Try to detect social media from website (common patterns)
  if (place.websiteURI) {
    const site = place.websiteURI.toLowerCase();
    if (site.includes('facebook.com')) links.push({ icon: 'üìò', label: 'Facebook', url: place.websiteURI, display: 'Facebook Page' });
    if (site.includes('instagram.com')) links.push({ icon: 'üì∑', label: 'Instagram', url: place.websiteURI, display: 'Instagram Profile' });
    if (site.includes('twitter.com') || site.includes('x.com')) links.push({ icon: 'üê¶', label: 'Twitter / X', url: place.websiteURI, display: 'Twitter Profile' });
  }

  if (links.length === 0) { el.style.display = 'none'; return; }
  el.style.display = 'block';
  el.innerHTML = `<h2 class="section-title">Links</h2>` + links.map(l =>
    `<a class="link-row" href="${l.url}" target="_blank" rel="noopener">
      <div class="link-icon">${l.icon}</div>
      <div class="link-info">
        <div class="link-label">${l.label}</div>
        <div class="link-url">${l.display}</div>
      </div>
      <div class="link-arrow">‚Ä∫</div>
    </a>`
  ).join('');
}

function shareListing() {
  const url = window.location.href;
  const title = 'Hampton Court Palace ‚Äî Scenic Route';
  const text = 'Check out Hampton Court Palace on Scenic Route!';

  if (navigator.share) {
    navigator.share({ title, text, url }).catch(() => {});
  } else {
    navigator.clipboard.writeText(url).then(() => {
      const toast = document.getElementById('shareToast');
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 2000);
    }).catch(() => {
      prompt('Copy this link:', url);
    });
  }
}

async function loadYouTube() {
  try {
    const res = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&q=${encodeURIComponent('Hampton Court Palace')}&type=video&maxResults=3&videoDuration=medium&relevanceLanguage=en&key=${API_KEY}`);
    const data = await res.json();
    if (!data.items || !data.items.length) { document.getElementById('videoCards').innerHTML = ''; return; }
    const play = '<svg viewBox="0 0 24 24"><polygon points="8,5 19,12 8,19"/></svg>';
    document.getElementById('videoCards').innerHTML = data.items.slice(0, 3).map(item => {
      const vid = item.id.videoId;
      const title = item.snippet.title.replace(/&amp;/g,'&').replace(/&#39;/g,"'").replace(/&quot;/g,'"');
      const ch = item.snippet.channelTitle;
      const th = item.snippet.thumbnails.medium.url;
      return `<div class="video-card" onclick="this.outerHTML='<div class=\\'video-embed\\'><iframe src=\\'https://www.youtube.com/embed/${vid}?autoplay=1\\' allow=\\'autoplay; encrypted-media\\' allowfullscreen></iframe></div>'"><div class="video-thumb"><img src="${th}" loading="lazy"/><div class="play-btn">${play}</div></div><div class="video-meta"><div class="video-title">${title}</div><div class="video-channel">${ch}</div></div></div>`;
    }).join('');
  } catch(e) { document.getElementById('videoCards').innerHTML = ''; }
}

loadGoogleData();
loadYouTube();
</script>
</body>
</html>
